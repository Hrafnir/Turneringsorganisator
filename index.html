<!-- Version: #9 -->
<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turneringssjefen v9.0</title>
    <link rel="icon" href="data:,">
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>

    <!-- LYDEFFEKTER (Skjulte elementer for robust lydavspilling) -->
    <!-- Vi bruker Web Audio API i JS, men dette er placeholders hvis vi trenger filer senere -->

    <!-- ========================================= -->
    <!-- VIEW 1: ADMIN PANEL (Det du styrer med) -->
    <!-- ========================================= -->
    <div id="adminView">
        
        <!-- WINNER OVERLAY (Admin ser ogs√• dette) -->
        <div id="winnerOverlay" class="winner-overlay hidden" onclick="closeWinner()">
            <div class="confetti"></div>
            <div class="trophy-container">
                <i class="fas fa-trophy trophy-icon"></i>
                <h1>VINNEREN ER K√ÖRET!</h1>
                <h2 id="winnerText">LAG NAVN</h2>
                <p>(Klikk for √• avslutte)</p>
            </div>
        </div>

        <!-- NAV -->
        <nav class="no-print">
            <div class="logo-area">
                <div class="logo">üèÜ <span id="displayTitle">Turnering</span> <span class="version">v9.0</span></div>
                <input type="text" id="tournamentTitleInput" placeholder="Tittel..." onchange="updateTitle(this.value)" class="title-input">
            </div>
            
            <div class="nav-actions">
                <button onclick="openDashboard()" class="btn-spectacular-small" title="√Öpne visning for publikum"><i class="fas fa-desktop"></i> √ÖPNE STORSKJERM</button>
                
                <div class="file-controls">
                    <button onclick="saveToFile()" class="btn-small-blue"><i class="fas fa-download"></i> Lagre</button>
                    <label class="btn-small-blue">
                        <i class="fas fa-upload"></i> Last inn
                        <input type="file" id="fileInput" onchange="loadFromFile()" style="display:none;">
                    </label>
                </div>
            </div>

            <div class="tabs">
                <button onclick="showTab('setup')" class="active">1. Oppsett</button>
                <button onclick="showTab('arena')">2. Arena</button>
                <button onclick="showTab('draw')">3. Lag & Print</button>
                <button onclick="showTab('matches')">4. Kamper</button>
                <button onclick="showTab('finals')">5. Finale</button>
                <button onclick="confirmReset()" class="btn-small-red"><i class="fas fa-trash"></i></button>
            </div>
        </nav>

        <!-- TAB 1: OPPSETT -->
        <div id="setup" class="tab-content active no-print">
            <div class="container">
                <div class="header-split">
                    <h2>1. Klasser og Elever</h2>
                    <div class="class-manager">
                        <input type="text" id="newClassInput" placeholder="Ny klasse..." style="width:100px;">
                        <button onclick="addClass()" class="btn-green">+</button>
                    </div>
                </div>
                <div class="setup-grid">
                    <div class="input-section">
                        <label>Velg klasse:</label>
                        <div id="classButtons" class="class-buttons"></div>
                        <textarea id="pasteArea" placeholder="Lim inn navn..."></textarea>
                        <button onclick="addStudents()" class="btn-primary block-btn">Legg til</button>
                    </div>
                    <div class="list-section">
                        <div class="header-row">
                            <h3>Registrerte (<span id="studentCount">0</span>)</h3>
                            <input type="text" id="studentSearch" placeholder="üîç S√∏k..." onkeyup="renderStudentList()" class="search-input">
                            <button onclick="clearStudents()" class="btn-text-red">Slett alle</button>
                        </div>
                        <div id="studentList" class="student-grid"></div>
                    </div>
                </div>
                <div class="footer-actions">
                    <button class="btn-primary" onclick="showTab('arena')">Neste <i class="fas fa-arrow-right"></i></button>
                </div>
            </div>
        </div>

        <!-- TAB 2: ARENA -->
        <div id="arena" class="tab-content no-print">
            <div class="container">
                <h2>2. Tider og Baner</h2>
                <div class="config-grid">
                    <div class="config-box">
                        <h3>‚è∞ Tidsplan</h3>
                        <div class="form-row"><label>Starttid:</label><input type="time" id="startTime" value="10:15"></div>
                        <div class="form-row"><label>Finalestart:</label><input type="time" id="finalsTime" value="14:00"></div>
                        <div class="form-row"><label>Kamp (min):</label><input type="number" id="matchDuration" value="15"></div>
                        <div class="form-row"><label>Pause (min):</label><input type="number" id="breakDuration" value="5"></div>
                        <button class="btn-yellow-outline" onclick="recalcFutureSchedule()">üîÑ Oppdater fremtidige tider</button>
                    </div>
                    <div class="config-box">
                        <h3>üèüÔ∏è Baner</h3>
                        <div id="courtList"></div>
                        <button onclick="addCourt()" class="btn-green-outline">+ Legg til bane</button>
                    </div>
                </div>
                <div class="footer-actions">
                    <button class="btn-primary" onclick="showTab('draw')">Neste <i class="fas fa-arrow-right"></i></button>
                </div>
            </div>
        </div>

        <!-- TAB 3: LAGTREKNING & PRINT -->
        <div id="draw" class="tab-content">
            <div class="container print-container">
                <!-- PRINT HEADER (Kun synlig ved utskrift) -->
                <div class="print-header">
                    <h1 id="printTitle">Turneringslag</h1>
                    <p>Lykke til!</p>
                </div>

                <div class="no-print">
                    <h2>3. Laginndeling</h2>
                    <div class="draw-controls">
                        <div class="draw-option">
                            <label>Metode:</label>
                            <select id="drawStrategy" onchange="toggleCustomMix()">
                                <option value="balanced">‚öñÔ∏è Perfekt Miks (Anbefalt)</option>
                                <option value="class_based">üè´ Klassevis</option>
                                <option value="ab_cd">üÖ∞Ô∏èüÖ±Ô∏è A+B / C+D</option>
                                <option value="custom">üõ†Ô∏è Egendefinert</option>
                                <option value="random">üé≤ Kaos</option>
                            </select>
                        </div>
                        
                        <div id="customMixPanel" class="hidden custom-mix-panel">
                            <p>Pulje 1 (resten blir Pulje 2):</p>
                            <div id="customClassCheckboxes" class="checkbox-group"></div>
                        </div>

                        <div class="draw-option">
                            <label>Antall lag:</label>
                            <input type="number" id="teamCount" value="12" style="width:60px;">
                        </div>

                        <button class="btn-primary" onclick="generateTeams()">‚ö° Generer</button>
                        <button class="btn-grey" onclick="window.print()"><i class="fas fa-print"></i> Skriv ut</button>
                        <button id="lockBtn" class="btn-yellow" onclick="toggleLockTeams()"><i class="fas fa-unlock"></i> √Öpen</button>
                    </div>
                    <p class="info-text">Dra og slipp spillere mellom boksene for √• endre lag (m√• v√¶re "√Öpen").</p>
                </div>

                <div id="drawDisplay" class="draw-grid"></div>
                
                <div class="generate-section no-print">
                    <button class="btn-primary" onclick="generateSchedule()">üìÖ Generer Kampoppsett</button>
                </div>
            </div>
        </div>

        <!-- TAB 4: KAMPPLAN -->
        <div id="matches" class="tab-content no-print">
            <!-- Admin Timer Panel -->
            <div class="admin-timer-panel">
                <div class="timer-display-small" id="adminTimerDisplay">15:00</div>
                <div class="timer-controls">
                    <button onclick="startTimer()" class="btn-green"><i class="fas fa-play"></i></button>
                    <button onclick="pauseTimer()" class="btn-yellow"><i class="fas fa-pause"></i></button>
                    <button onclick="resetTimer()" class="btn-red"><i class="fas fa-undo"></i></button>
                    <button onclick="playHorn()" class="btn-grey"><i class="fas fa-bullhorn"></i></button>
                </div>
                <div class="sys-clock">Klokke: <span id="adminRealTime">--:--</span></div>
            </div>

            <div class="container">
                <div class="schedule-tools">
                    <button onclick="addManualMatch()" class="btn-text">+ Ekstra kamp</button>
                    <button onclick="clearSchedule()" class="btn-text-red">Slett alt</button>
                </div>
                <div id="scheduleContainer"></div>
            </div>
        </div>

        <!-- TAB 5: FINALE -->
        <div id="finals" class="tab-content no-print">
            <div class="finals-layout">
                <div class="finals-sidebar">
                    <h3>Finaleoppsett</h3>
                    <label>Lag 1:</label><select id="finalTeam1"></select>
                    <label>Lag 2:</label><select id="finalTeam2"></select>
                    <label>Type:</label><select id="finalType"><option>Gullfinale</option><option>Bronsefinale</option><option>Finale</option></select>
                    <label>Aktivitet:</label><input type="text" id="finalAct" value="Volleyball">
                    
                    <button onclick="activateFinalMode()" class="btn-spectacular-small" style="width:100%; margin-top:20px;">
                        <i class="fas fa-tv"></i> VIS P√Ö STORSKJERM
                    </button>
                    
                    <hr>
                    <h3>Tabell (Topp 8)</h3>
                    <div class="mini-leaderboard">
                        <table class="leaderboard-table small">
                            <thead><tr><th>#</th><th>Lag</th><th>P</th></tr></thead>
                            <tbody id="miniLeaderboard"></tbody>
                        </table>
                    </div>
                </div>

                <div class="finals-stage-admin">
                    <h2>Finale Kontrollpanel</h2>
                    <p>Bruk dette panelet til √• styre finalen mens Storskjerm viser resultatet.</p>
                    
                    <div class="stage-teams-admin">
                        <div class="team-box">
                            <h3 id="adminStageT1">Lag 1</h3>
                            <input type="number" id="adminStageS1" value="0" onchange="syncFinalScore()">
                        </div>
                        <div class="versus">VS</div>
                        <div class="team-box">
                            <h3 id="adminStageT2">Lag 2</h3>
                            <input type="number" id="adminStageS2" value="0" onchange="syncFinalScore()">
                        </div>
                    </div>

                    <button class="btn-spectacular" onclick="endTournament()">üèÜ K√ÖR VINNER & AVSLUTT</button>
                    <button class="btn-grey" onclick="exitFinalMode()" style="margin-top:10px;">Avslutt Finalemodus (Tilbake til serie)</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ========================================= -->
    <!-- VIEW 2: STORSKJERM (DASHBOARD)          -->
    <!-- Dette vises kun n√•r url har ?mode=dashboard -->
    <!-- ========================================= -->
    <div id="dashboardView" class="hidden">
        
        <!-- NORMAL MODE: SERIESPILL -->
        <div id="dashSeriesMode">
            <div class="dash-grid-v9">
                
                <!-- KOLONNE 1: TIMER & KONTROLL (65%) -->
                <div class="dash-col-left">
                    <div class="dash-clock-header">
                        <div class="dash-title-small" id="dashTitle">TURNERING</div>
                        <div id="dashClock">--:--</div>
                    </div>

                    <div class="timer-wrapper">
                        <div id="dashTimer" class="dash-big-digits">15:00</div>
                        <div id="dashStatus" class="dash-status">KLAR</div>
                        <div id="dashStartTime" class="dash-start-time">Kampstart: --:--</div>
                    </div>

                    <div class="dash-controls">
                        <button onclick="startTimer()" class="btn-ctrl-dash btn-green"><i class="fas fa-play"></i> START</button>
                        <button onclick="pauseTimer()" class="btn-ctrl-dash btn-yellow"><i class="fas fa-pause"></i> PAUSE</button>
                        <button onclick="adjustTimer(1)" class="btn-ctrl-dash btn-grey">+1 MIN</button>
                        <button onclick="adjustTimer(-1)" class="btn-ctrl-dash btn-grey">-1 MIN</button>
                        <button onclick="playHorn()" class="btn-ctrl-dash btn-red"><i class="fas fa-bullhorn"></i> HORN</button>
                    </div>
                </div>

                <!-- KOLONNE 2: INFO (35%) -->
                <div class="dash-col-right">
                    <!-- √òVRE DEL: AKKURAT N√Ö (2/3) -->
                    <div class="dash-sub-panel current-matches">
                        <h2>AKKURAT N√Ö</h2>
                        <div id="dashActiveMatches" class="active-matches-list">
                            <!-- Fylles med JS -->
                        </div>
                    </div>

                    <!-- NEDRE DEL: NESTE RUNDE (1/3) -->
                    <div class="dash-sub-panel next-matches">
                        <h2>NESTE RUNDE</h2>
                        <div id="dashNextMatches" class="next-matches-list">
                            <!-- Fylles med JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- FINAL MODE: FINALEVISNING -->
        <div id="dashFinalMode" class="hidden">
            <div class="final-overlay-content">
                <h1 id="dashFinalTitle">GULLFINALE</h1>
                <h2 id="dashFinalAct">VOLLEYBALL</h2>
                
                <div class="final-score-board">
                    <div class="final-team">
                        <div class="ft-name" id="dashFinalT1">LAG A</div>
                        <div class="ft-score" id="dashFinalS1">0</div>
                    </div>
                    <div class="final-vs">VS</div>
                    <div class="final-team">
                        <div class="ft-name" id="dashFinalT2">LAG B</div>
                        <div class="ft-score" id="dashFinalS2">0</div>
                    </div>
                </div>

                <div class="final-timer-container">
                    <div id="dashFinalTimer">15:00</div>
                </div>
                
                <div class="dash-controls" style="margin-top:20px;">
                    <button onclick="startTimer()" class="btn-ctrl-dash btn-green">START</button>
                    <button onclick="pauseTimer()" class="btn-ctrl-dash btn-yellow">PAUSE</button>
                    <button onclick="playHorn()" class="btn-ctrl-dash btn-red">HORN</button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
